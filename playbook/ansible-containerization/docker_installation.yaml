---
  - name: install docker and docker compose 
    hosts: all
    become: yes

    tasks:
      - name: update apt 
        apt:
          update_cache: yes
      
      - name: Install required packages
        apt:
          name:
            - apt-transport-https
            - ca-certificates
            - curl
            - software-properties-common
            - gnupg
      
      - name: Add Docker GPG key
        apt_key:
          url: https://download.docker.com/linux/ubuntu/gpg
          state: present
      
      - name: Add Docker Repository
        apt_repository:
          repo:  deb [arch=amd64] https://download.docker.com/linux/ubuntu {{ ansible_distribution_release }} stable
          state: present
          filename: docker
      
      - name: Update APT again after adding Docker repo
        apt:
          update_cache: yes

      - name: Install Docker Engine
        apt:
          name:
            - docker-ce
            - docker-ce-cli
            - containerd.io
          state: latest

      - name: Install Docker Compose plugin
        apt:
          name: docker-compose-plugin
          state: latest

      - name: Ensure Docker service is started and enabled
        service:
          name: docker
          state: started
          enabled: true

      - name: Add current user to docker group
        user:
          name: "{{ ansible_user }}"
          groups: docker
          append: yes

    

      

      